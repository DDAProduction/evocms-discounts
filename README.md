## EvocmsDiscounts
Модуль скидок для Commerce. Во многом похож на CommerceDiscounts.

## Требования
php >= 7.4 && mysql 5.6

### Установка
1. php artisan package:installrequire ddaproduction/evocms-discounts "*"
2. php artisan vendor:publish  --provider="EvolutionCMS\EvocmsDiscounts\EvocmsDiscountsServiceProvider"
3. php artisan migrate


### Общая информация
Есть два типа скидок. Скидка для товаров, и скидки для корзины. 
Скидка состоит из условий, при которых она будет действовать и способа применения.
Можно указать скидку в процентах или в конкретной сумме.
Применяется самая большая скидка.


### Условия
В каждой скидке, можно указать список условий, которые будут ограничивать действие скидки.

#### Категории 
Распространяется на товары.   
Позволяет ограничить список категорий, на товары которых распространяется скидка.

#### Период из 
Распространяется на товары и корзину. 
Позволяет указать с какой даты действует скидка.

#### Период по 
Распространяется на товары и корзину. 
Позволяет указать до какой даты действует скидка.

#### Товары 
Распространяется на товары.                     
Позволяет ограничить список товаров, на которые распространяется скидка.

#### Группа пользователей 
Распространяется на товары и корзину.
Позволяет ограничить скидку для конкретной группы пользователей.

#### Пользователи
Распространяется на товары и корзину.
Позволяет ограничить скидку для конкретных пользователей.


### Применения
Позволяет указать условие и способ применения скидки для товара или корзины.

#### Начиная с
Позволяет задать после какого количества или суммы скидка начинает действовать.
Скидка будет применена на вновь добавленные товарвы.   
Например: купи 4 и получи 50% на остальные товары.

#### Для каждого
Позволяет задать скидку ждя каждого n товара. Например, каждый второй из скидкой 50%.

#### При достижении
Позволяет задать скидку, которая начнет действовать на все товары, при достижении условия.
Например, при покупке 10 товаров, скидка на все 10%

#### Начиная с (для корзины)

Позволяет задать после какого количества или суммы товаров, будет действовать скидка.
Например: купи на 5000 рублей, и получи скидку 5%.

#### Накопительная

Позволяет задать скидку в зависимости от суммы покупок пользователя.
Можно указать как сумму, так и период. Скидка кешируется и пересчитывается командой `evocms-discounts:cumulative-update`
Запуск которой нужно добавить в крон, с нужной вам периодичностью.


### Настройки

Для настройки работы модуля можно создать файл `core/custom/config/evocms-discount.php`.
На текущий момент доступные следующий настройки
```php
return [
    'rules'=>[
        'product'=>[
            'templates'=>[] // позволяет указать шаблоны, ресурсы которых являются товарами
        ],
        'categories'=>[
            'depth'=>10, // глубина поиска категор  ий
            'parents'=>0, // папка в которых искать категории
            'templates'=>[], // список шаблонов, ресурсы которых являются категориями
        ],

    ],
    'apply'=>[
        'cart_cumulative_apply'=>[
            'statuses'=>[] // список статусов заказов, которые необходимо учитывать, при расчете накопительной скидки
        ]
    ]
];

```